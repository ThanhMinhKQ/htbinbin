<!DOCTYPE html>
<html lang="vi" class="h-full">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>ƒêƒÉng Nh·∫≠p - Bin Bin Hotel Christmas</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@500;600;700&display=swap" rel="stylesheet">
  
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            sans: ["Quicksand", "system-ui", "sans-serif"]
          },
          colors: {
            xmas: {
              red: '#D42426',
              green: '#146B3A',
              gold: '#F8B229',
              dark: '#0F172A'
            }
          },
          animation: {
            'float': 'float 6s ease-in-out infinite',
            'shine': 'shine 3s linear infinite',
            'shake': 'shake 0.4s ease-in-out',
            'fade-in-up': 'fadeInUp 0.8s ease-out forwards',
          },
          keyframes: {
            float: {
              '0%, 100%': { transform: 'translateY(0)' },
              '50%': { transform: 'translateY(-10px)' },
            },
            shine: {
              '0%': { backgroundPosition: '200% center' },
              '100%': { backgroundPosition: '-200% center' },
            },
            shake: {
              '0%, 100%': { transform: 'translateX(0)' },
              '20%, 60%': { transform: 'translateX(-5px)' },
              '40%, 80%': { transform: 'translateX(5px)' }
            },
            fadeInUp: {
              '0%': { opacity: '0', transform: 'translateY(20px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' }
            }
          }
        }
      }
    }
  </script>

  <style>
    /* N·ªÅn t·ªëi m·∫∑c ƒë·ªãnh - Gradient ·∫•m √°p l·ªÖ h·ªôi */
    html.dark body {
        background: radial-gradient(circle at 50% 30%, #1e293b, #0f172a, #450a0a);
    }

    /* N·ªÅn s√°ng - Gradient tinh kh√¥i */
    html:not(.dark) body {
        background: linear-gradient(to bottom right, #e0f2fe, #ffffff);
    }

    /* Glassmorphism Card cao c·∫•p */
    .glass-card {
        background: rgba(255, 255, 255, 0.75);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.6);
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
    }
    
    .dark .glass-card {
        background: rgba(15, 23, 42, 0.65);
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.4);
    }

    /* Ch·ªØ Gold Gradient l·∫•p l√°nh */
    .text-gold-gradient {
        background: linear-gradient(to right, #b45309, #fbbf24, #b45309);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        background-size: 200% auto;
        animation: shine 4s linear infinite;
    }
    .dark .text-gold-gradient {
        background: linear-gradient(to right, #fcd34d, #fffbeb, #fcd34d);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        background-size: 200% auto;
    }

    /* Custom Input Style */
    .input-glass {
        background: rgba(255, 255, 255, 0.5);
        border: 1px solid rgba(0,0,0,0.1);
        transition: all 0.3s ease;
    }
    .dark .input-glass {
        background: rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255,255,255,0.1);
    }
    .input-glass:focus {
        background: rgba(255, 255, 255, 0.9);
        border-color: #D42426; /* M√†u ƒë·ªè gi√°ng sinh */
        box-shadow: 0 0 0 3px rgba(212, 36, 38, 0.2);
    }
    .dark .input-glass:focus {
        background: rgba(0, 0, 0, 0.5);
        border-color: #F8B229; /* M√†u v√†ng gold */
        box-shadow: 0 0 0 3px rgba(248, 178, 41, 0.2);
    }
  </style>
</head>

<body class="h-full flex items-center justify-center relative overflow-hidden text-slate-800 dark:text-slate-100 selection:bg-xmas-red selection:text-white">

  <canvas id="snowCanvas" class="absolute inset-0 pointer-events-none z-0"></canvas>
  <audio id="bg-audio" loop>
      <source src='/static/sounds/giangsinh.mp3' type="audio/mpeg">
  </audio>

  <div class="w-full max-w-md px-4 z-10 animate-fade-in-up">
    
    <div class="absolute top-4 right-4 z-20 flex gap-2">
        <button id="btn-music" class="p-2 rounded-full bg-white/50 dark:bg-black/20 hover:bg-white/80 transition shadow-sm group border border-white/20" title="B·∫≠t/T·∫Øt nh·∫°c">
            <div id="icon-music-on" class="hidden relative w-5 h-5 flex items-center justify-center">
                <span class="absolute w-full h-full border border-red-500 rounded-full opacity-0 animate-ping"></span>
                <svg class="w-5 h-5 text-xmas-red" fill="currentColor" viewBox="0 0 24 24"><path d="M14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77zm-4 0c-4.01.91-7 4.49-7 8.77s2.99 7.86 7 8.77v-2.06c-2.89-.86-5-3.54-5-6.71s2.11-5.85 5-6.71V3.23zM9 13.5h2.83L14.17 16V8L11.83 10.5H9v3z"/></svg>
            </div>
            <div id="icon-music-off" class="w-5 h-5 flex items-center justify-center">
                <svg class="w-5 h-5 text-slate-500 dark:text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" stroke-miterlimit="10"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2" /></svg>
            </div>
        </button>

        <button id="btn-theme" class="p-2 rounded-full bg-white/50 dark:bg-black/20 hover:bg-white/80 transition shadow-sm border border-white/20" title="Ch·∫ø ƒë·ªô S√°ng/T·ªëi">
            <svg id="icon-sun" class="w-5 h-5 text-yellow-600 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></svg>
            <svg id="icon-moon" class="w-5 h-5 text-slate-600 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>
        </button>
    </div>

    <div id="loginBox" class="glass-card rounded-[2rem] p-8 relative overflow-hidden">
        
        <div class="absolute -top-10 -right-10 w-32 h-32 opacity-20 dark:opacity-10 pointer-events-none rotate-12">
            <svg viewBox="0 0 24 24" fill="currentColor" class="text-xmas-red w-full h-full">
                <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z" />
            </svg>
        </div>

        <div class="text-center mb-8 relative">
            <div class="inline-block relative">
                <img src="/static/logo.png" alt="Logo" class="h-12 mx-auto mb-2 drop-shadow-md hover:scale-105 transition-transform duration-300">
            </div>
            <p class="text-xs font-bold text-xmas-red uppercase tracking-[0.2em] mb-1">Bin Bin Hotel</p>
            <h1 class="text-2xl font-bold">
                ƒêƒÉng Nh·∫≠p <span class="text-gold-gradient">Gi√°ng Sinh</span> üéÑ
            </h1>
        </div>

        {% if error %}
        <div class="mb-6 flex items-center gap-3 bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800/50 text-red-600 dark:text-red-300 px-4 py-3 rounded-xl text-sm font-semibold animate-shake">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
            </svg>
            {{ error }}
        </div>
        {% endif %}

        <form method="post" action="/login" class="space-y-5">
            
            <div>
                <label for="username" class="block text-sm font-bold mb-1.5 ml-1 text-slate-600 dark:text-slate-300">M√£ nh√¢n vi√™n</label>
                <div class="relative group">
                    <div class="absolute inset-y-0 left-0 pl-3.5 flex items-center pointer-events-none">
                        <svg class="h-5 w-5 text-slate-400 group-focus-within:text-xmas-red transition-colors" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                        </svg>
                    </div>
                    <input type="text" id="username" name="username" required
                        class="input-glass w-full pl-11 pr-4 py-3 rounded-xl text-sm font-semibold placeholder:font-normal placeholder:text-slate-400 dark:text-white focus:outline-none"
                        placeholder="Nh·∫≠p m√£ s·ªë c·ªßa b·∫°n" />
                </div>
            </div>

            <div>
                <label for="password" class="block text-sm font-bold mb-1.5 ml-1 text-slate-600 dark:text-slate-300">M·∫≠t kh·∫©u</label>
                <div class="relative group">
                    <div class="absolute inset-y-0 left-0 pl-3.5 flex items-center pointer-events-none">
                        <svg class="h-5 w-5 text-slate-400 group-focus-within:text-xmas-red transition-colors" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd" />
                        </svg>
                    </div>
                    <input type="password" id="password" name="password" required
                        class="input-glass w-full pl-11 pr-12 py-3 rounded-xl text-sm font-semibold placeholder:font-normal placeholder:text-slate-400 dark:text-white focus:outline-none"
                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
                    
                    <button type="button" id="togglePassword" class="absolute inset-y-0 right-0 pr-3.5 flex items-center text-slate-400 hover:text-slate-600 dark:hover:text-slate-200 transition-colors focus:outline-none">
                        <svg id="eyeIcon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                        </svg>
                    </button>
                </div>
            </div>

            <button type="submit"
                class="w-full bg-gradient-to-r from-xmas-red to-[#b91c1c] hover:from-[#b91c1c] hover:to-xmas-red text-white font-bold py-3.5 rounded-xl transition-all duration-300 transform hover:scale-[1.02] shadow-lg shadow-red-500/30 flex items-center justify-center gap-2 group">
                <span>ƒêƒÉng Nh·∫≠p Ngay</span>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 group-hover:translate-x-1 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
                </svg>
            </button>

            <div class="text-center">
                <button type="button" onclick="alert('Vui l√≤ng li√™n h·ªá qu·∫£n l√Ω ƒë·ªÉ ƒë∆∞·ª£c c·∫•p l·∫°i m·∫≠t kh·∫©u m·ªõi! üéÖ')"
                    class="text-xs font-semibold text-slate-500 dark:text-slate-400 hover:text-xmas-red dark:hover:text-xmas-gold transition-colors hover:underline">
                    Qu√™n m·∫≠t kh·∫©u?
                </button>
            </div>

        </form>

        <p class="mt-8 text-[10px] text-center text-slate-400 font-medium">
            &copy; {{ now.year if now else "2025" }} Bin Bin Hotel Management System
        </p>
    </div>

  </div>

  <script>
    // --- HI·ªÜU ·ª®NG N·ªÄN ƒê·ªòNG (Copy Logic t·ª´ Show QR) ---
    (function() {
        const canvas = document.getElementById('snowCanvas');
        const ctx = canvas.getContext('2d');
        let width, height;
        let particles = [];
        let currentTheme = 'dark'; 

        function resize() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        // Tuy·∫øt r∆°i (Dark mode)
        function createSnowflake() {
            return {
                x: Math.random() * width,
                y: Math.random() * -height,
                radius: Math.random() * 2 + 1,
                speed: Math.random() * 1 + 0.5,
                opacity: Math.random() * 0.5 + 0.3
            };
        }

        function drawSnowflakes() {
            ctx.clearRect(0, 0, width, height);
            ctx.fillStyle = "white";
            particles.forEach(f => {
                ctx.globalAlpha = f.opacity;
                ctx.beginPath();
                ctx.arc(f.x, f.y, f.radius, 0, Math.PI * 2);
                ctx.fill();
                f.y += f.speed;
                f.x += Math.sin(f.y * 0.01) * 0.5;
                if (f.y > height) {
                    Object.assign(f, createSnowflake(), { y: -5 });
                }
            });
        }

        // L√° r∆°i (Light mode)
        const leafColors = ['#D42426', '#F8B229', '#f97316', '#ca8a04', '#eab308'];
        function createLeaf() {
            return {
                x: Math.random() * width,
                y: Math.random() * -height,
                size: Math.random() * 10 + 8,
                speed: Math.random() * 1 + 1,
                rotation: Math.random() * 360,
                rotationSpeed: (Math.random() - 0.5) * 2,
                sway: Math.random() * 2 - 1,
                color: leafColors[Math.floor(Math.random() * leafColors.length)]
            };
        }

        function drawLeaves() {
            ctx.clearRect(0, 0, width, height);
            particles.forEach(leaf => {
                ctx.save();
                ctx.translate(leaf.x, leaf.y);
                ctx.rotate(leaf.rotation * Math.PI / 180);
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.quadraticCurveTo(leaf.size / 2, -leaf.size / 4, leaf.size, 0);
                ctx.quadraticCurveTo(leaf.size / 2, leaf.size / 4, 0, 0);
                ctx.closePath();
                ctx.fillStyle = leaf.color;
                ctx.fill();
                ctx.restore();

                leaf.y += leaf.speed;
                leaf.x += leaf.sway + Math.sin(leaf.y * 0.05);
                leaf.rotation += leaf.rotationSpeed;

                if (leaf.y > height) {
                    Object.assign(leaf, createLeaf(), { y: -20 });
                }
            });
        }

        let animationFrameId;
        function animate() {
            if (currentTheme === 'dark') {
                drawSnowflakes();
            } else {
                drawLeaves();
            }
            animationFrameId = requestAnimationFrame(animate);
        }

        window.setThemeEffect = function(theme) {
            if (theme === currentTheme && particles.length > 0) return;
            currentTheme = theme;
            particles = [];
            const particleCount = currentTheme === 'dark' ? 80 : 40; // Gi·∫£m b·ªõt s·ªë l∆∞·ª£ng cho login ƒë·ª° r·ªëi
            const createParticle = currentTheme === 'dark' ? createSnowflake : createLeaf;
            for(let i = 0; i < particleCount; i++) {
                particles.push(createParticle());
            }
            if (!animationFrameId) {
                animate();
            }
        }
    })();

    // --- FORM LOGIC ---
    const togglePassword = document.getElementById("togglePassword");
    const passwordInput = document.getElementById("password");
    const eyeIcon = document.getElementById("eyeIcon");
    
    togglePassword.addEventListener("click", () => {
      const isHidden = passwordInput.type === "password";
      passwordInput.type = isHidden ? "text" : "password";
      eyeIcon.innerHTML = isHidden
        ? `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.477 0-8.268-2.943-9.542-7a9.964 9.964 0 012.185-3.412M15 12a3 3 0 00-4.243-2.829M3 3l18 18" />`
        : `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />`;
    });

    // --- THEME & MUSIC LOGIC ---
    const root = document.documentElement;
    const THEME_KEY = 'theme-mode';
    const audio = document.getElementById('bg-audio');
    const btnMusic = document.getElementById('btn-music');
    const iconOn = document.getElementById('icon-music-on');
    const iconOff = document.getElementById('icon-music-off');
    let isPlaying = false;

    // Music control
    audio.volume = 0.3; // Nh·∫°c n·ªÅn login ƒë·ªÉ nh·ªè h∆°n ch√∫t
    function toggleMusicState(play, userInitiated = false) {
        if (play) {
            const playPromise = audio.play();
            if (playPromise !== undefined) {
              playPromise.then(() => {
                isPlaying = true;
                iconOn.classList.remove('hidden');
                iconOff.classList.add('hidden');
                document.body.removeEventListener('click', playMusicOnFirstInteraction, { once: true });
              }).catch(error => {
                if (!userInitiated) {
                  document.body.addEventListener('click', playMusicOnFirstInteraction, { once: true });
                }
              });
            }
        } else {
            audio.pause();
            isPlaying = false;
            iconOn.classList.add('hidden');
            iconOff.classList.remove('hidden');
        }
    }
    const playMusicOnFirstInteraction = () => toggleMusicState(true, true);
    btnMusic.addEventListener('click', () => toggleMusicState(!isPlaying, true));
    
    // Theme Control
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    function applyTheme(mode){
        if (mode === 'dark' || (mode === 'system' && prefersDark)) {
          root.classList.add('dark');
          document.getElementById('icon-sun').classList.remove('hidden');
          document.getElementById('icon-moon').classList.add('hidden');
          window.setThemeEffect('dark');
        } else {
          root.classList.remove('dark');
          document.getElementById('icon-sun').classList.add('hidden');
          document.getElementById('icon-moon').classList.remove('hidden');
          window.setThemeEffect('light');
        }
    }
    const savedTheme = localStorage.getItem(THEME_KEY) || 'system';
    applyTheme(savedTheme);
    
    document.getElementById('btn-theme').addEventListener('click', () => {
        const current = localStorage.getItem(THEME_KEY) || 'system';
        const next = current === 'dark' ? 'light' : 'dark';
        localStorage.setItem(THEME_KEY, next);
        applyTheme(next);
    });

    // T·ª± ƒë·ªông b·∫≠t nh·∫°c khi t·∫£i trang
    toggleMusicState(true);

    // Clean URL
    if (window.location.search.includes("error=")) {
      const url = new URL(window.location.href);
      url.searchParams.delete("error");
      window.history.replaceState({}, document.title, url.pathname);
    }
    
    // Login Success Animation
    if (window.location.search.includes("success=1")) {
      const loginBox = document.getElementById("loginBox");
      loginBox.style.transition = "all 0.8s ease";
      loginBox.style.transform = "scale(1.1)";
      loginBox.style.opacity = "0";
      setTimeout(() => { window.location.href = "/choose-function"; }, 800);
    }
  </script>

</body>
</html>
